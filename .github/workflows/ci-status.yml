name: 📊 CI Status & Badges

on:
  workflow_run:
    workflows: 
      - "🚀 Comprehensive CI Pipeline"
      - "🔄 Dependency Management & Security"
      - "🌐 Deployment & Performance Optimization"
      - "🎯 Contract & API Validation"
      - "🎨 Visual Regression & Cross-Browser Testing"
      - "📊 Analytics & Insights Dashboard"
    types:
      - completed

jobs:
  update-badges:
    name: 📊 Update CI Status Badges
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion != 'cancelled'
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 📊 Generate status summary
        run: |
          echo "# 🚀 Fairytales with Spice - CI Status" > CI_STATUS.md
          echo "" >> CI_STATUS.md
          echo "## 🔄 Workflow Status" >> CI_STATUS.md
          echo "" >> CI_STATUS.md
          
          # Add badges for each workflow
          echo "[![Comprehensive CI](https://github.com/${{ github.repository }}/actions/workflows/ci-comprehensive.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/ci-comprehensive.yml)" >> CI_STATUS.md
          echo "[![Dependency Management](https://github.com/${{ github.repository }}/actions/workflows/dependency-management.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/dependency-management.yml)" >> CI_STATUS.md
          echo "[![Deployment](https://github.com/${{ github.repository }}/actions/workflows/deployment-optimization.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/deployment-optimization.yml)" >> CI_STATUS.md
          echo "[![Contract Validation](https://github.com/${{ github.repository }}/actions/workflows/contract-validation.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/contract-validation.yml)" >> CI_STATUS.md
          echo "[![Visual Testing](https://github.com/${{ github.repository }}/actions/workflows/visual-testing.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/visual-testing.yml)" >> CI_STATUS.md
          echo "[![Analytics](https://github.com/${{ github.repository }}/actions/workflows/analytics-dashboard.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/analytics-dashboard.yml)" >> CI_STATUS.md
          echo "" >> CI_STATUS.md
          
          echo "## 📊 System Health" >> CI_STATUS.md
          echo "- **Last Updated**: $(date -u)" >> CI_STATUS.md
          echo "- **Workflow**: ${{ github.event.workflow_run.name }}" >> CI_STATUS.md
          echo "- **Status**: ${{ github.event.workflow_run.conclusion }}" >> CI_STATUS.md
          echo "- **Branch**: ${{ github.event.workflow_run.head_branch }}" >> CI_STATUS.md

      - name: 📊 Update README badges
        run: |
          # Create or update badge section in README
          if [ -f "README.md" ]; then
            # Add CI status section if it doesn't exist
            if ! grep -q "## 🚀 CI Status" README.md; then
              echo "" >> README.md
              echo "## 🚀 CI Status" >> README.md
              echo "" >> README.md
              echo "[![Comprehensive CI](https://github.com/${{ github.repository }}/actions/workflows/ci-comprehensive.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/ci-comprehensive.yml)" >> README.md
              echo "[![Security](https://github.com/${{ github.repository }}/actions/workflows/dependency-management.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/dependency-management.yml)" >> README.md
              echo "[![Deployment](https://github.com/${{ github.repository }}/actions/workflows/deployment-optimization.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/deployment-optimization.yml)" >> README.md
              echo "" >> README.md
              echo "> **Extensive CI System**: Going deeper than normal to find value others miss" >> README.md
            fi
          fi

      - name: 📊 Create workflow summary
        run: |
          echo "### 🚀 Extensive CI System Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Workflow Completed**: ${{ github.event.workflow_run.name }}" >> $GITHUB_STEP_SUMMARY
          echo "**Status**: ${{ github.event.workflow_run.conclusion }}" >> $GITHUB_STEP_SUMMARY
          echo "**Branch**: ${{ github.event.workflow_run.head_branch }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "#### 🎯 System Highlights" >> $GITHUB_STEP_SUMMARY
          echo "- ✅ **6 Comprehensive Workflows**: Beyond standard CI/CD" >> $GITHUB_STEP_SUMMARY
          echo "- 🔍 **Deep Analytics**: Code quality, performance, security insights" >> $GITHUB_STEP_SUMMARY
          echo "- 🛡️ **Advanced Security**: Multi-layer vulnerability protection" >> $GITHUB_STEP_SUMMARY
          echo "- 🎨 **Visual Excellence**: Cross-browser, accessibility, responsive testing" >> $GITHUB_STEP_SUMMARY
          echo "- 📊 **Business Intelligence**: Predictive analytics and optimization" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "#### 📈 Value Added" >> $GITHUB_STEP_SUMMARY
          echo "This extensive CI system finds value others miss through:" >> $GITHUB_STEP_SUMMARY
          echo "- Predictive maintenance and issue prevention" >> $GITHUB_STEP_SUMMARY
          echo "- Comprehensive quality gates and optimization" >> $GITHUB_STEP_SUMMARY
          echo "- Strategic business intelligence and analytics" >> $GITHUB_STEP_SUMMARY
          echo "- Enterprise-grade security and compliance" >> $GITHUB_STEP_SUMMARY