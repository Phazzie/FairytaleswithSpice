# Digital Ocean Deployment Guide
## Fairytales with Spice

This guide provides step-by-step instructions for deploying Fairytales with Spice to Digital Ocean App Platform.

## üöÄ Quick Deploy

### Option 1: One-Click Deploy (Recommended)
[![Deploy to DO](https://www.deploytodo.com/do-btn-blue.svg)](https://cloud.digitalocean.com/apps/new?repo=https://github.com/Phazzie/FairytaleswithSpice/tree/main&refcode=your-referral-code)

### Option 2: Manual Deploy

1. **Fork the Repository**
   ```bash
   # Fork https://github.com/Phazzie/FairytaleswithSpice to your account
   ```

2. **Create Digital Ocean App**
   - Go to [Digital Ocean Apps](https://cloud.digitalocean.com/apps)
   - Click "Create App"
   - Connect your GitHub account
   - Select your forked repository

3. **Configure App Settings**
   - Use the included `app.yaml` configuration
   - Or configure manually:
     - **Runtime**: Node.js 20
     - **Build Command**: `npm run build:full`
     - **Run Command**: `/usr/local/bin/start.sh`
     - **Port**: 8080

4. **Set Environment Variables**
   ```bash
   NODE_ENV=production
   PORT=8080
   FRONTEND_URL=${APP_URL}  # Auto-generated by DO
   
   # Optional: Add your API keys
   XAI_API_KEY=your_grok_api_key_here
   ELEVENLABS_API_KEY=your_elevenlabs_api_key_here
   ```

5. **Deploy**
   - Click "Create Resources"
   - Wait for deployment to complete (~5-10 minutes)

## üê≥ Docker Deployment

### Local Testing
```bash
# Build and run with Docker Compose
docker-compose up --build

# Access the app
open http://localhost:8080

# Test with production-like setup
docker-compose --profile prod up --build
open http://localhost
```

### Manual Docker Deployment
```bash
# Build the container
docker build -t fairytales-spice .

# Run the container
docker run -p 8080:8080 \
  -e NODE_ENV=production \
  -e FRONTEND_URL=http://localhost:8080 \
  fairytales-spice

# With API keys
docker run -p 8080:8080 \
  -e NODE_ENV=production \
  -e XAI_API_KEY=your_key \
  -e ELEVENLABS_API_KEY=your_key \
  fairytales-spice
```

## ‚öôÔ∏è Configuration Options

### Environment Variables

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `NODE_ENV` | Yes | `development` | Environment mode |
| `PORT` | Yes | `8080` | Server port |
| `FRONTEND_URL` | Yes | `http://localhost:8080` | CORS origin |
| `XAI_API_KEY` | No | - | Grok AI API key (uses mocks if not provided) |
| `ELEVENLABS_API_KEY` | No | - | ElevenLabs TTS key (uses mocks if not provided) |

### Resource Requirements

| Tier | CPU | Memory | Storage | Cost/Month |
|------|-----|--------|---------|------------|
| Basic | 1 vCPU | 512 MB | 1 GB | $5 |
| Professional | 2 vCPU | 1 GB | 2 GB | $12 |
| Performance | 4 vCPU | 2 GB | 4 GB | $24 |

**Recommended**: Basic tier for small to medium usage (up to 10K requests/month)

## üîç Health Checks

The application includes built-in health checks:

- **Endpoint**: `/api/health`
- **Method**: GET
- **Response**: JSON with service status
- **Docker**: Built-in healthcheck with 30s interval

Example health check response:
```json
{
  "status": "healthy",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "version": "1.0.0",
  "environment": "production",
  "services": {
    "grok": "configured",
    "elevenlabs": "mock"
  }
}
```

## üìä Monitoring & Logging

### Digital Ocean Insights
- Enable insights in the Digital Ocean dashboard
- Monitor CPU, memory, and request metrics
- Set up alerts for high usage or errors

### Application Logs
```bash
# View logs in Digital Ocean dashboard
# Or access via CLI:
doctl apps logs <app-id>

# Docker logs (local)
docker logs <container-id>
```

### Custom Alerts
Configure alerts for:
- CPU usage > 80%
- Memory usage > 80%
- Error rate > 5%
- Response time > 2s

## üîí Security Considerations

### Production Security Checklist
- [x] **Environment Variables**: API keys stored as secrets
- [x] **HTTPS**: Automatically enabled by Digital Ocean
- [x] **Security Headers**: X-Frame-Options, CORS, etc.
- [x] **Container Security**: Non-root user, minimal dependencies
- [x] **Input Validation**: All API inputs validated
- [x] **Rate Limiting**: Built into API services

### Additional Security (Optional)
- Set up a Web Application Firewall (WAF)
- Enable DDoS protection
- Configure custom domains with SSL certificates
- Set up log monitoring and alerting

## üîÑ CI/CD Pipeline

### Automatic Deployments
Digital Ocean automatically deploys when you push to the main branch.

### Manual Deployment Control
```bash
# Disable auto-deploy and deploy manually:
git push origin main
# Then trigger deployment in DO dashboard
```

### Staging Environment
Create a separate app for staging:
```bash
# Create staging branch
git checkout -b staging

# Configure separate DO app for staging
# Use staging-specific environment variables
```

## üêõ Troubleshooting

### Common Issues

**Build Failures**
- Check Node.js version (requires 20.x)
- Verify all dependencies are included
- Check build logs in Digital Ocean dashboard

**Runtime Errors**
- Check environment variables are set correctly
- Verify health check endpoint responds
- Review application logs

**Performance Issues**
- Monitor resource usage in DO insights
- Consider upgrading to higher tier
- Optimize API response caching

**API Mock Mode**
- App works without API keys using realistic mocks
- Set API keys as secrets for full functionality
- Check logs to confirm API key detection

### Support Resources
- üìò [Digital Ocean App Platform Docs](https://docs.digitalocean.com/products/app-platform/)
- üéØ [GitHub Issues](https://github.com/Phazzie/FairytaleswithSpice/issues)
- üí¨ [GitHub Discussions](https://github.com/Phazzie/FairytaleswithSpice/discussions)

## üìà Scaling

### Horizontal Scaling
- Increase instance count in app configuration
- Digital Ocean automatically load balances

### Vertical Scaling
- Upgrade instance size in app settings
- No downtime required for most upgrades

### Global Distribution
- Consider deploying to multiple regions
- Use Digital Ocean Spaces for CDN distribution

---

**Need help?** Open an issue on [GitHub](https://github.com/Phazzie/FairytaleswithSpice/issues) or check our [troubleshooting guide](../README.md#troubleshooting).