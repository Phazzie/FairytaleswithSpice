<div class="story-generator">
  <header class="header">
    <h1>üßö‚Äç‚ôÄÔ∏è Fairytales with Spice</h1>
    <p>Create spicy fantasy stories with your favorite creatures</p>
  </header>

  <div class="main-content">
    <!-- Left Column: Story Generation Form -->
    <div class="form-section" ngSkipHydration>
      <h2>Story Configuration</h2>

      <!-- Creature Selector -->
      <div class="form-group">
        <label>Choose Your Creature:</label>
        <div class="radio-group">
          <label class="radio-option" *ngFor="let creature of creatures; trackBy: trackByCreature">
            <input type="radio" name="creature" [value]="creature.value" [(ngModel)]="selectedCreature">
            <span class="radio-label">{{creature.label}}</span>
          </label>
        </div>
      </div>

      <!-- Theme Checkboxes -->
      <div class="form-group">
        <label>Story Themes ({{getSelectedThemesCount()}}/5 selected):</label>
        <div class="checkbox-group">
          <label class="checkbox-option" 
                 *ngFor="let theme of themes; trackBy: trackByTheme" 
                 [class.selected]="isThemeSelected(theme.value)"
                 [class.disabled]="!canSelectMoreThemes() && !isThemeSelected(theme.value)">
            <input type="checkbox" 
                   [checked]="isThemeSelected(theme.value)"
                   [disabled]="!canSelectMoreThemes() && !isThemeSelected(theme.value)"
                   (change)="toggleTheme(theme.value)">
            <span class="checkbox-label">{{theme.label}}</span>
          </label>
        </div>
      </div>

      <!-- User Input -->
      <div class="form-group">
        <label for="userInput">Your Ideas (Optional):</label>
        <textarea
          id="userInput"
          [(ngModel)]="userInput"
          placeholder="Describe characters, settings, or plot elements you'd like to include..."
          rows="4">
        </textarea>
      </div>

      <!-- Spicy Level Slider -->
      <div class="form-group">
        <label>Spicy Level: {{spicyLevelLabels[spicyLevel - 1]}}</label>
        <div class="slider-container">
          <input
            type="range"
            min="1"
            max="5"
            [(ngModel)]="spicyLevel"
            class="spicy-slider">
          <div class="slider-labels">
            <span>Mild</span>
            <span>Warm</span>
            <span>Hot</span>
            <span>Spicy</span>
            <span>Fire üî•</span>
          </div>
        </div>
      </div>

      <!-- Word Count Dropdown -->
      <div class="form-group">
        <label for="wordCount">Word Count:</label>
        <select id="wordCount" [(ngModel)]="wordCount">
          <option *ngFor="let option of wordCountOptions" [value]="option.value">
            {{option.label}}
          </option>
        </select>
      </div>

      <!-- Generate Button -->
      <button
        class="generate-btn"
        (click)="generateStory()"
        [disabled]="isGenerating || !canGenerateStory()">
        <span *ngIf="!isGenerating && canGenerateStory()">‚ú® Generate Story</span>
        <span *ngIf="!isGenerating && !canGenerateStory()">‚ùå Select at least one theme</span>
        <span *ngIf="isGenerating" class="loading">
          <span class="spinner"></span>
          Crafting your tale...
        </span>
      </button>
    </div>

    <!-- Right Column: Story Display -->
    <div class="story-column">
      <!-- Story Display -->
      <div class="story-section" *ngIf="currentStory">
        <div class="story-header">
          <h2>Your Spicy {{getCreatureName()}} Story</h2>
          <div class="story-actions">
            <button
              class="action-btn audio-btn"
              (click)="convertToAudio()"
              [disabled]="isConvertingAudio">
              <span *ngIf="!isConvertingAudio">üîä Convert to Audio</span>
              <span *ngIf="isConvertingAudio" class="loading">
                <span class="spinner"></span>
                Converting...
              </span>
            </button>

            <button
              class="action-btn save-btn"
              (click)="saveStory()"
              [disabled]="isSaving">
              <span *ngIf="!isSaving">üíæ Save Story</span>
              <span *ngIf="isSaving" class="loading">
                <span class="spinner"></span>
                Saving...
              </span>
            </button>
          </div>
        </div>

        <div class="story-content" [innerHTML]="currentStory"></div>

        <div class="story-footer">
          <button
            class="continue-btn"
            (click)="generateNextChapter()"
            [disabled]="isGeneratingNext">
            <span *ngIf="!isGeneratingNext">üìñ Generate Next Chapter</span>
            <span *ngIf="isGeneratingNext" class="loading">
              <span class="spinner"></span>
              Writing next chapter...
            </span>
          </button>
        </div>
      </div>

      <!-- Placeholder when no story -->
      <div class="story-placeholder" *ngIf="!currentStory">
        <div class="placeholder-content">
          <h2>Your Story Will Appear Here</h2>
          <p>Configure your story settings on the left and click "Generate Story" to begin!</p>
          <div class="placeholder-icon">üìö‚ú®</div>
        </div>
      </div>

      <!-- Audio Progress -->
      <div class="audio-progress" *ngIf="audioProgress > 0">
        <h3>Audio Conversion Progress</h3>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="audioProgress"></div>
        </div>
        <p>{{audioProgress}}% complete</p>
      </div>

      <!-- Success Messages -->
      <div class="success-message" *ngIf="saveSuccess">
        ‚úÖ Story saved successfully!
      </div>

      <div class="success-message" *ngIf="audioSuccess">
        üéµ Audio conversion completed! Download ready.
      </div>
    </div>
  </div>

  <!-- Error Display Component -->
  <app-error-display></app-error-display>
</div>

<!-- Debug Panel Component -->
<app-debug-panel #debugPanel></app-debug-panel>


